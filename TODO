Move api calls, authentication etc to middleware
